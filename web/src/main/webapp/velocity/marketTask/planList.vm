#parse("/velocity/taglibs.vm")<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    <title>产品营销计划</title>    #scriptLink("core")	#scriptLink("page")	<script type="text/javascript" src="${ctx}/js/controls/jquery.validator.dateSearchCheck-v1.0.js"></script>    <script type="text/javascript">    	var oldPostJson={};	//上一个搜索条件    	    	/**		 * 分页跳转		 */		function gotoPage(page){			goto(				page,				"/tskMarketingPlan/queryPlanList.html?RandNum="+ Math.random(),				oldPostJson,				function(html){					queryResult(html);				});		}				/**		 * 分页跳转或者查询结果		 */		function queryResult(html){			jQuery("#tblList").html(html).table();			//更新记录数			var total = jQuery('#productCount').val();			if(total!=undefined){				jQuery(".green").text(total);			}else {				jQuery(".green").text("0");			}		}				/*		 * 初始化oldPostJson查询数据		 */		function initQueryJson(){			var postJson={};	   		oldPostJson = postJson;	   		return postJson;	   	}	   	    	$(function(){			$('table.datatbl').table();			$('select').select();			jQuery("#btnClear").click(function(){				$(':text').val('');		    	$("#userIds").val('');		    	$("select").each(function(){		    		this.selectedIndex = 0;		    		$(this).select();		    	}); 			});						jQuery("#btnClose").click(function(){				tab.close(GetId(), false);			});						jQuery("#btnSearch").click(function(){				var selectedUserIds = jQuery.trim($('#userIds').val());				var planDateFrom = jQuery.trim(jQuery("#planDateFrom").val());				var planDateTo = jQuery.trim(jQuery("#planDateTo").val());								var postJson = {'selectedUserIds': selectedUserIds,							  'planDateFrom': planDateFrom,							  'planDateTo': planDateTo};				oldPostJson = postJson;  //记录OldPostJson				jQuery.ajax({			    	type: "post",			    	url: "/tskMarketingPlan/queryPlanList.html?RandNum="+ Math.random(),			    	data: postJson,			    	success: function(data){			 	  		queryResult(data);			    	}				});			});						//加载下属树			$('#userList').subtree({				tid: 'subtree',				showIcon: true,				url: function(){ return '/customer/getCusBelongToJson.html?BelongToType=brUser&random=' + Math.random(); },				buttons: [					{ text: '确定', callback: onCheckUser },					{ text: '取消' }				]			});						initQueryJson();		});				//点击User		function onCheckUser(treeId){			var postJson = {};			postJson = getCheckJson(treeId, 'U');			$('#userIds').val(postJson.ids);			$('#userText').val(postJson.names);		}		 			function getCheckJson(treeId, flag){			var treeObj = jQuery.fn.zTree.getZTreeObj(treeId);			var nodes = treeObj.getCheckedNodes(true);			var len = nodes.length;			var uIds = "";			var uName = "";			for(var i=0; i<len; i++){				if(flag=='U'){					if(nodes[i].flag==flag){						if(uIds==""){							uIds = nodes[i].id;							uName = nodes[i].name;						}else{							uIds = uIds + "," + nodes[i].id;							uName = uName+ "," +nodes[i].name;						}					}				}else{					if(uIds==""){						uIds = nodes[i].id;						uName = nodes[i].name;					}else{						uIds = uIds + "," + nodes[i].id;						uName = uName+ "," +nodes[i].name;					}					}			}			var postJson = {};			postJson['ids'] = uIds;			postJson['names'] = uName;			return postJson;		}					function toDetailList(planId) {			var url="/tskMarketingPlan/planListDetail.html?planId="+planId+"&random="+Math.random()*10000;			//window.showModalDialog(url, '产品营销计划表', 'dialogWidth=800px;dialogHeight=600px;toolbar=no;menubar=no;scrollbars=no;resizable=no;location=no;status=no');			banger.page.openDialog(url,"产品营销计划表",800,600);		}    </script></head><body style="padding-bottom: 0px;">    	<table class="htmltbl">		<tbody>			<tr>				<td class="field" width="8%">					<label>执行对象：</label>				</td>				<td width="17%">					<div id="userList" class="ui-div-text" style="width: 200px;">                        <input type="text" class="text" readonly="readonly" id="userText"/>                        <input id="userIds" name="userIds" type="hidden" />                        <i class="ddl" id="ddlchange"></i>                    </div>				</td>				<td class="field" width="8%">					<label>计划日期：</label>				</td>				<td colspan="3">					<table class="celltbl">						<tbody>							<tr>								<td width="120">									<div class="ui-div-text">										<input id="planDateFrom" type="text" class="text datepicker"  readonly="true"/>										<i class="date"></i>									</div>								</td>								<td width="20"><label>-</label></td>								<td width="120">									<div class="ui-div-text">										<input id="planDateTo" type="text" class="text datepicker" readonly="true" />										<i class="date"></i>									</div>								</td>							</tr>						</tbody>					</table>				</td>			</tr>		</tbody>	</table>	<div class="search-bar">		<span class="fl bold">			所有产品(<label class="green">$!productCount</label>)		</span>		<input type="button" id="btnClear" class="ui-input-btn" value="清空" />		<input type="button" id="btnSearch" class="ui-input-btn" value="搜索" />	</div>	<table id="tblList" class="datatbl">		#parse("/velocity/marketTask/planListTable.vm")	</table>	<hr />	<div class="center">		<input type="button" id="btnClose" class="ui-footer-btn1 ui-footer-btn1-cancel" value="关闭" />	</div></body></html>