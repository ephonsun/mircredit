#parse("/velocity/taglibs.vm")<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    <title>选择可计划产品</title>        <link type="text/css" rel="stylesheet" href="${ctx}/css/basic.css" />    <link type="text/css" rel="stylesheet" href="${ctx}/css/public.css" />    <link type="text/css" rel="stylesheet" href="${ctx}/css/tree/zTreeStyle.css" />        #scriptLink("core")	#scriptLink("page")	<script type="text/javascript" src="${ctx}/js/system/b.base.js"></script>	<script type="text/javascript" src="${ctx}/js/plugins/jquery.ztree.core-3.2.js"></script>	<script type="text/javascript" src="${ctx}/js/plugins/jquery.ztree.exedit-3.2.js"></script>	<script type="text/javascript" src="${ctx}/js/controls/jquery.table-v1.0.js"></script>			<style type="text/css">		div.ui-panel-box1 { margin-top:10px;}		div.ui-panel-box1 div.r { margin-left: 170px; }		div.ui-panel-box1 div.r div.r-inner { height: 510px; border: 1px solid #ccc; background: url(../images/public/scroll.gif) repeat-y right center; overflow: auto; }		div.ui-panel-box1 div.r div.r-inner div.r-contact{ width: 740px; height: 488px; padding: 10px;}		div.ui-panel-box1 div.r div.r-inner div.r-contact div.contact-amount { border: 1px solid #b1b1b1; margin-bottom: 10px; padding: 5px 10px; line-height: 24px; }    	div.ui-panel-box1 div.r div.r-inner div.r-contact div.contact-amount label.ml { margin-left: 20px; }	</style>    <script type="text/javascript">    	var setting = {			callback:{				onClick:treeOnclick			},			data: {				simpleData: {					enable: true				}			},			view: {				showIcon: false			}					};		//json树数据		var zNodes = $!taskTree; 				//默认选择第一个节点		function initNodeSelect(){    		var treeObj = jQuery.fn.zTree.getZTreeObj("taskTree");    		var nodes = treeObj.getNodes();			if (nodes.length>0) {    			treeObj.selectNode(nodes[0]);    			treeOnclick(event, nodes[0].id, nodes[0]);				$("#gradeId").val(nodes[0].type);				if(nodes[0].type=="A" || nodes[0].type=="G"){					$("#planShow").show();				}    		}		}				function treeOnclick(event, treeId, treeNode) {			$("#gradeId").val(treeNode.type);			$("#marketingId").val(treeNode.id);			//搜索产品			searchTaskProduct($("#marketingId").val()); 		}				//搜索审核人 		function searchTaskProduct(marketingId){ 			jQuery.ajax({		    	type: "post",		    	url: "/tskMarketingPlan/productList.html?random="+Math.random()*10000,		    	data: {'marketingId':marketingId,'gradeId':$("#gradeId").val()},		    	success: function(html){		 	  		searchResult(html);		    	}			}); 		} 		 		function searchResult(html){			$(".r-contact").html(html);			var gradeId=$("#gradeId").val();			if(gradeId=="A" || gradeId=="G"){				$("#planShow").hide();			}else{				$("#planShow").show();			}		}				//分页跳转		function gotoPage(page){			var postJson = {};    		postJson['marketingId']=jQuery.trim($('#marketingId').val());			postJson['gradeId']=jQuery.trim($('#gradeId').val());			goto(page,'../tskMarketingPlan/productList.html?random='+Math.random(),postJson,function(html){searchResult(html);});		}		 		//机构树加载		$(document).ready(function(){			jQuery.fn.zTree.init($("#taskTree"), setting, zNodes);			initNodeSelect();			searchTaskProduct($("#marketingId").val());//默认产品列表		});				$(function(){			$('table.datatbl').table();			$("#planShow").hide();			/** 确定按钮 **/			$('.ui-footer-btn1-save').click(function(){				var formData = $("#form1").serialize();				if (formData.indexOf('productId') <= 0) {					banger.page.showMessageBox("请您选择在售产品!");					return ;				}								jQuery.ajax({				  type: 'POST',				  url: '/tskMarketingPlan/productAdd.html',				  data: $("#form1").serialize(),				  async: false,				  success:function(){				  	window.returnValue = 1;				  	window.close();				  }				});				});						/** 取消按钮 **/			$('.ui-footer-btn1-cancel').click(function(){				window.returnValue = 0;				window.close();			});		});    </script></head><body scroll="no" style="overflow:hidden;">	<form id="form1">	<input type="hidden" id="marketingId" name="marketingId" value="$!firstMarketingId" />	<input type="hidden" id="gradeId" name="gradeId" value="$!gradeId" />	<div class="ui-panel-box1">		<div class="l">            <div class="l-inner" style="height:515px; width:148px; overflow:auto;">                <ul id="taskTree" class="ztree"></ul>            </div>        </div>        <div class="r">            <div class="r-inner" style="position:relative; height:525px;">				<div class="r-contact">					 #parse("/velocity/marketTask/selectProductTable.vm")				</div>			</div>   	 	</div>	</div>    <hr />    <div class="center">    	<input type="button" class="ui-footer-btn1 ui-footer-btn1-save" value="确定" />    	<input type="button" class="ui-footer-btn1 ui-footer-btn1-cancel" value="取消" />    </div>    </form></body></html>