#parse("/velocity/taglibs.vm")<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    <title>当天执行的营销计划</title>    #styleLink("base")    <link type="text/css" rel="stylesheet" href="${ctx}/css/basic.css" />    <link type="text/css" rel="stylesheet" href="${ctx}/css/public.css" />        <style type="text/css">    	span.ml { margin-left: 5px; }		/*当天执行的计划提示下拉框*/        .MyeditInfo{position: absolute; display: none; border: 1px solid #b1b1b1; background-color: #fff; height: auto; width:300px; overflow: auto; zoom: 1; text-align:left;}        .MyeditInfo table{ border-collapse:collapse; empty-cells:show; width:auto; table-layout:fixed;}        .MyeditInfo table tr { }        .MyeditInfo table tr td{ height:22px; line-height:22px; width:100%;}        .MyeditInfo table tr td p{padding: 2px 10px;font-size:12px; }        .MyeditInfo table tr td h3{padding: 2px 2px;font-size:14px; }        .MyeditInfo table tr td h4{padding: 2px 10px;font-size:12px;}        .wote{display:inline-block; vertical-align:middle;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}        	</style>    #scriptLink("core")	#scriptLink("page")    <script type="text/javascript" src="${ctx}/js/system/b.base.js"></script>	<script type="text/javascript" src="${ctx}/js/system/b.date.js"></script>	<script type="text/javascript" src="${ctx}/js/plugins/jquery.plugins.js"></script>	<script type="text/javascript" src="${ctx}/js/banger/banger.tabs-v1.interface.js"></script>	<script type="text/javascript" src="${ctx}/js/controls/jquery.table-v1.0.js"></script>	<script type="text/javascript" src="${ctx}/js/controls/jquery.editRemark-v1.0.js"></script>	<script type="text/javascript" src="${ctx}/js/controls/jquery.validator-v1.0.js"></script>    <script type="text/javascript">		$(function(){			jQuery("#form1").validator();			$('table.datatbl').table();			editRemarkN('.edit');//修改备注			numInput("input[name='planDetailTarget']");			$('.Myedit').click(function(e){			  	var box = $('#tips_'+$(this).attr('id'));			  				  	$('.MyeditInfo').hide();				var obj = $(this);				box.css({					'z-index':1,					top: obj.offset().top + obj.outerHeight(true) - 1 + 'px',					left: obj.offset().left + 'px'				}).show();				obj = null;				box = null;				e.stopPropagation();			});							/**			 * 窗体大小发生改变时弹框相对位置			**/			$(window).resize(function(){				$('.MyeditInfo').hide();			});			/**			 * 点击窗体其他区域隐藏请求者层			**/			$(document).click(function(){				$('.MyeditInfo').hide();			});			/**			 * 阻止请求者层中的元素事件冒泡			**/			$('.MyeditInfo').click(function(e){				e.stopPropagation();			});						/** 保存按钮 **/			$('.ui-footer-btn1-save').click(function(){				var bool = jQuery.validator({ form: 'form1'});				if(!bool){					return false;				}				var isOk = true;				var productName = "";				$("input[name='planDetailTarget']").each(function(){						var planDetailTarget = $(this).val();						var daysRemainTarget = $("#days_"+$(this).attr("id")).val();						var templateRate = $("#rate_"+$(this).attr("id")).val();						var target = planDetailTarget - daysRemainTarget * templateRate / 100;						if (target < 0){							isOk = false;							productName = $("#pdt_"+$(this).attr("id")).html();							$(this).parent().addClass('v-fails');						} else {							$(this).parent().removeClass('v-fails');						}					}				);								if (!isOk) {					if(confirm("‘"+productName+"’的‘计划营销额’小于任务的日均剩余营销额，将不计入考核，是否关闭页卡？")) {						jQuery.ajax({						  type: 'POST',						  url: '/tskMarketingPlan/planDetailAdd.html',						  data: $("#form1").serialize(),						  success:function(){						  	tab.close(GetId(), false);						  }						});						}				} else {					jQuery.ajax({					  type: 'POST',					  url: '/tskMarketingPlan/planDetailAdd.html',					  data: $("#form1").serialize(),					  success:function(){					  	tab.close(GetId(), false);					  }					});					}							});						/** 取消按钮 **/			$('.ui-footer-btn1-cancel').click(function(){				var isChange = formIsChange(document.getElementById("form1"));				if(isChange){					if(confirm("放弃新建并关闭选项卡？")) {    					tab.close(GetId(), false);    				}				}else tab.close(GetId(), false);			});						/** 选择产品 **/			$('#selectProduct').click(function(){				var url="/tskMarketingPlan/selectProduct.html?random="+Math.random()*10000;				//var result=window.showModalDialog(url, '选择可计划产品', 'dialogWidth=975px;dialogHeight=645px;toolbar=no;menubar=no;scrollbars=no;resizable=no;location=no;status=no');				var result=banger.page.openDialog(url,"选择可计划产品",975,645); 				if(result == 1){					window.location.reload();				} 								});		});				function cfirm(){			var isChange = formIsChange(document.getElementById("form1"));			if(isChange){				if(confirm("放弃新建并关闭选项卡？")){    				return true;    			}			}else return true;		}				function post(tr, text){		}				function updateRemark(tr, text){						$("input[name='remark']",tr).val(text);		}				//查看产品		function detailProduct(id){			jQuery.post("../tskMarketingPlan/validateProductIsDel.html?random="+Math.random(),{				'pdtProduct.productId':id			},function(data){				if(data==0){					banger.page.showMessageBox({"content":"产品“"+$("#pName_"+id).val()+"”已被删除，无法查看具体资料!","width":350});				}else{					var options = {id: "detail_product"+id, pid: GetId(), title: "查看产品", url: "/pdtProduct/editProduct.html?pdtProduct.productId="+id+"&actionType=detail&random="+Math.random(), lock: false,confirm: false};    				tab.add(options);				}			});		}				function vTarget(obj){			var v=obj.value;			var todaySaleMoney=$("#t_"+obj.id).text();			if(v.length==0){				$(obj).attr('tips', '“拟营销额”必须填写!'); return false;			}else{				var p=new RegExp(",","g");    			var target=String(todaySaleMoney).replace(p,"");    			if(parseFloat(v)<parseFloat(target)){					$(obj).attr('tips', '拟营销额不能够小于实际销售额!'); return false;    			}			}			return true;		}    </script></head><body>	<form id="form1">	<div style="margin:10px;">		<div class="search-bar">			<span class="fl bold">				当天产品计划:			</span>			<span class="fl ml">				产品(<label class="green">$!recordCount</label>),			</span>			<span class="fl ml">				计划营销额(<label class="green">$vmHelper.getDecimalWanMoney($!recordTotal)</label>)万元			</span>		</div>		#if($isManager==1)		<div class="action-bar">			<span id="selectProduct" class="ui-span-btn fl">				<label>选择在售产品</label>			</span>		</div>		#end		<table id="dataList" class="datatbl">			#parse("/velocity/marketTask/planDetailListTable.vm")		</table>		<hr />		<div class="center">			<input type="button" class="ui-footer-btn1 ui-footer-btn1-save" value="保存" />			<input type="button" class="ui-footer-btn1 ui-footer-btn1-cancel" value="取消" />		</div>	</div>	</form></body></html>