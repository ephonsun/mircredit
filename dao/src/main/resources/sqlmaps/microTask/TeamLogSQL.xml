<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TeamLogSQL">
    <typeAlias alias="TeamLog" type="com.banger.mobile.domain.model.microTask.TeamLog"/>

    <resultMap id="teamLogResult" class="TeamLog">
        <result property="teamLogId" column="TEAM_LOG_ID"/>
        <result property="userId" column="USER_ID"/>
        <result property="zrzjdhyx" column="ZRZJDHYX" nullValue="0"/>
        <result property="zrzjsdyx" column="ZRZJSDYX" nullValue="0"/>
        <result property="zrzjjdzx" column="ZRZJJDZX" nullValue="0"/>
        <result property="zrzjjdsq" column="ZRZJJDSQ" nullValue="0"/>
        <result property="zrzjdcbs" column="ZRZJDCBS" nullValue="0"/>
        <result property="zrzjfdbs" column="ZRZJFDBS" nullValue="0"/>
        <result property="zrzjdhbs" column="ZRZJDHBS" nullValue="0"/>
        <result property="zrzjshbs" column="ZRZJSHBS" nullValue="0"/>
        <result property="jrjhdhyx" column="JRJHDHYX" nullValue="0"/>
        <result property="jrjhsdyx" column="JRJHSDYX" nullValue="0"/>
        <result property="jrjhjdzc" column="JRJHJDZC" nullValue="0"/>
        <result property="jrjhjdsq" column="JRJHJDSQ" nullValue="0"/>
        <result property="jrjhdcbs" column="JRJHDCBS" nullValue="0"/>
        <result property="jrjhfdbs" column="JRJHFDBS" nullValue="0"/>
        <result property="jrjhdhbs" column="JRJHDHBS" nullValue="0"/>
        <result property="jrjhshbs" column="JRJHSHBS" nullValue="0"/>
        <result property="dclbs" column="DCLBS" nullValue="0"/>
        <result property="byxzbs" column="BYXZBS" nullValue="0"/>
        <result property="byzdbs" column="BYZDBS" nullValue="0"/>
        <result property="bydjbs" column="BYDJBS" nullValue="0"/>
        <result property="byljtgbs" column="BYLJTGBS" nullValue="0"/>
        <result property="bydqbs" column="BYDQBS" nullValue="0"/>
        <result property="byjzhsrwzb" column="BYJZHSRWZB" nullValue="0"/>
        <result property="byjzyerwzb" column="BYJZYERWZB" nullValue="0"/>
        <result property="bytqjqbs" column="BYTQJQBS" nullValue="0"/>
        <result property="bytqjqje" column="BYTQJQJE" nullValue="0"/>
        <result property="bytgwffje" column="BYTGWFFJE" nullValue="0"/>
        <result property="yjydfkje" column="YJYDFKJE" nullValue="0"/>
        <result property="yjydjzje" column="YJYDJZJE" nullValue="0"/>
        <result property="byfkbs" column="BYFKBS" nullValue="0"/>
        <result property="byfkjqll" column="BYFKJQLL" nullValue="0"/>
        <result property="byyyehs" column="BYYYEHS" nullValue="0"/>
        <result property="syyyehs" column="SYYYEHS" nullValue="0"/>
        <result property="byjzhs" column="BYJZHS" nullValue="0"/>
        <result property="byfkje" column="BYFKJE" nullValue="0"/>
        <result property="bydkye" column="BYDKYE" nullValue="0"/>
        <result property="sydkye" column="SYDKYE" nullValue="0"/>
        <result property="byjzye" column="BYJZYE" nullValue="0"/>
        <result property="createDate" column="CREATE_DATE"/>
        <result property="updateDate" column="UPDATE_DATE"/>
        <result property="createUser" column="CREATE_USER"/>
        <result property="updateUser" column="UPDATE_USER"/>
    </resultMap>

    <insert id="insertTeamLog" parameterClass="TeamLog">
        insert into TEAM_LOG(
        TEAM_LOG_ID,
        USER_ID,
        ZRZJDHYX,
        ZRZJSDYX,
        ZRZJJDZX,
        ZRZJJDSQ,
        ZRZJDCBS,
        ZRZJFDBS,
        ZRZJDHBS,
        ZRZJSHBS,
        JRJHDHYX,
        JRJHSDYX,
        JRJHJDZC,
        JRJHJDSQ,
        JRJHDCBS,
        JRJHFDBS,
        JRJHDHBS,
        JRJHSHBS,
        DCLBS,
        BYXZBS,
        BYZDBS,
        BYDJBS,
        BYLJTGBS,
        BYDQBS,
        BYJZHSRWZB,
        BYJZYERWZB,
        BYTQJQBS,
        BYTQJQJE,
        BYTGWFFJE,
        YJYDFKJE,
        YJYDJZJE,
        BYFKBS,
        BYFKJQLL,
        BYYYEHS,
        SYYYEHS,
        BYJZHS,
        BYFKJE,
        BYDKYE,
        SYDKYE,
        BYJZYE,
        CREATE_DATE,
        UPDATE_DATE,
        CREATE_USER,
        UPDATE_USER
        )values (
        #teamLogId:INTEGER#,
        #userId:INTEGER#,
        #zrzjdhyx:INTEGER#,
        #zrzjsdyx:INTEGER#,
        #zrzjjdzx:INTEGER#,
        #zrzjjdsq:INTEGER#,
        #zrzjdcbs:INTEGER#,
        #zrzjfdbs:INTEGER#,
        #zrzjdhbs:INTEGER#,
        #zrzjshbs:INTEGER#,
        #jrjhdhyx:INTEGER#,
        #jrjhsdyx:INTEGER#,
        #jrjhjdzc:INTEGER#,
        #jrjhjdsq:INTEGER#,
        #jrjhdcbs:INTEGER#,
        #jrjhfdbs:INTEGER#,
        #jrjhdhbs:INTEGER#,
        #jrjhshbs:INTEGER#,
        #dclbs:INTEGER#,
        #byxzbs:INTEGER#,
        #byzdbs:INTEGER#,
        #bydjbs:INTEGER#,
        #byljtgbs:INTEGER#,
        #bydqbs:INTEGER#,
        #byjzhsrwzb:INTEGER#,
        #byjzyerwzb:INTEGER#,
        #bytqjqbs:INTEGER#,
        #bytqjqje:DECIMAL#,
        #bytgwffje:DECIMAL#,
        #yjydfkje:DECIMAL#,
        #yjydjzje:DECIMAL#,
        #byfkbs:INTEGER#,
        #byfkjqll:DECIMAL#,
        #byyyehs:INTEGER#,
        #syyyehs:INTEGER#,
        #byjzhs:INTEGER#,
        #byfkje:DECIMAL#,
        #bydkye:DECIMAL#,
        #sydkye:DECIMAL#,
        #byjzye:DECIMAL#,
        #createDate:TIMESTAMP#,
        #updateDate:TIMESTAMP#,
        #createUser:INTEGER#,
        #updateUser:INTEGER#
        )
        <selectKey keyProperty="teamLogId" resultClass="java.lang.Integer" type="pre">
            VALUES NEXTVAL FOR SEQ_TEAM_LOG
        </selectKey>
    </insert>

    <update id="updateTeamLog" parameterClass="TeamLog">
        update TEAM_LOG set Team_Log_Id=#teamLogId#
        <isNotEmpty prepend="," property="zrzjdhyx">
            ZRZJDHYX = #zrzjdhyx#
        </isNotEmpty>
        <isNotEmpty prepend="," property="zrzjsdyx">
            ZRZJSDYX = #zrzjsdyx#
        </isNotEmpty>
        <isNotEmpty prepend="," property="zrzjjdzx">
            ZRZJJDZX = #zrzjjdzx#
        </isNotEmpty>
        <isNotEmpty prepend="," property="zrzjjdsq">
            ZRZJJDSQ = #zrzjjdsq#
        </isNotEmpty>
        <isNotEmpty prepend="," property="zrzjdcbs">
            ZRZJDCBS = #zrzjdcbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="zrzjfdbs">
            ZRZJFDBS = #zrzjfdbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="zrzjdhbs">
            ZRZJDHBS = #zrzjdhbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="zrzjshbs">
            ZRZJSHBS = #zrzjshbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="jrjhdhyx">
            JRJHDHYX = #jrjhdhyx#
        </isNotEmpty>
        <isNotEmpty prepend="," property="jrjhsdyx">
            JRJHSDYX = #jrjhsdyx#
        </isNotEmpty>
        <isNotEmpty prepend="," property="jrjhjdzc">
            JRJHJDZC = #jrjhjdzc#
        </isNotEmpty>
        <isNotEmpty prepend="," property="jrjhjdsq">
            JRJHJDSQ = #jrjhjdsq#
        </isNotEmpty>
        <isNotEmpty prepend="," property="jrjhdcbs">
            JRJHDCBS = #jrjhdcbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="jrjhfdbs">
            JRJHFDBS = #jrjhfdbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="jrjhdhbs">
            JRJHDHBS = #jrjhdhbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="jrjhshbs">
            JRJHSHBS = #jrjhshbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="dclbs">
            DCLBS = #dclbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="byxzbs">
            BYXZBS = #byxzbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="byzdbs">
            BYZDBS = #byzdbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="bydjbs">
            BYDJBS = #bydjbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="byljtgbs">
            BYLJTGBS = #byljtgbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="bydqbs">
            BYDQBS = #bydqbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="byjzhsrwzb">
            BYJZHSRWZB = #byjzhsrwzb#
        </isNotEmpty>
        <isNotEmpty prepend="," property="byjzyerwzb">
            BYJZYERWZB = #byjzyerwzb#
        </isNotEmpty>
        <isNotEmpty prepend="," property="bytqjqbs">
            BYTQJQBS = #bytqjqbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="bytqjqje">
            BYTQJQJE = #bytqjqje#
        </isNotEmpty>
        <isNotEmpty prepend="," property="bytgwffje">
            BYTGWFFJE = #bytgwffje#
        </isNotEmpty>
        <isNotEmpty prepend="," property="yjydfkje">
            YJYDFKJE = #yjydfkje#
        </isNotEmpty>
        <isNotEmpty prepend="," property="yjydjzje">
            YJYDJZJE = #yjydjzje#
        </isNotEmpty>
        <isNotEmpty prepend="," property="byfkbs">
            BYFKBS = #byfkbs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="byfkjqll">
            BYFKJQLL = #byfkjqll#
        </isNotEmpty>
        <isNotEmpty prepend="," property="byyyehs">
            BYYYEHS = #byyyehs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="syyyehs">
            SYYYEHS = #syyyehs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="byjzhs">
            BYJZHS = #byjzhs#
        </isNotEmpty>
        <isNotEmpty prepend="," property="byfkje">
            BYFKJE = #byfkje#
        </isNotEmpty>
        <isNotEmpty prepend="," property="bydkye">
            BYDKYE = #bydkye#
        </isNotEmpty>
        <isNotEmpty prepend="," property="sydkye">
            SYDKYE = #sydkye#
        </isNotEmpty>
        <isNotEmpty prepend="," property="byjzye">
            BYJZYE = #byjzye#
        </isNotEmpty>
        <isNotEmpty prepend="," property="createDate">
            CREATE_DATE = #createDate#
        </isNotEmpty>
        <isNotEmpty prepend="," property="updateDate">
            UPDATE_DATE = #updateDate#
        </isNotEmpty>
        <isNotEmpty prepend="," property="createUser">
            CREATE_USER = #createUser#
        </isNotEmpty>
        <isNotEmpty prepend="," property="updateUser">
            UPDATE_USER = #updateUser#
        </isNotEmpty>
        where Team_Log_Id=#teamLogId#
    </update>

    <select id="queryTeamLogsPageCount" resultClass="java.lang.Integer" parameterClass="java.util.Map">
        select count(1) from TEAM_LOG
        where 1=1
        <isNotEmpty prepend="and" property="teamLogId">
            TEAM_LOG_ID=#teamLogId#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="userId">
            USER_ID in (#userId#)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="updateDate">
            UPDATE_DATE=#updateDate#
        </isNotEmpty>
    </select>

    <select id="queryTeamLogsPage" parameterClass="java.util.Map" resultMap="teamLogResult">
        <isNotEmpty property="startRow">
            <isNotEmpty property="endRow">
                <![CDATA[
					SELECT * FROM (SELECT rownumber() over() AS NUMROW,g.* FROM (
	         	]]>
            </isNotEmpty>
        </isNotEmpty>

        select * from TEAM_LOG
        where 1=1
        <isNotEmpty prepend="and" property="teamLogId">
            TEAM_LOG_ID=#teamLogId#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="userId">
            USER_ID in (#userId#)
        </isNotEmpty>
        <isNotEmpty prepend="and" property="updateDate">
            UPDATE_DATE=#updateDate#
        </isNotEmpty>

        <isNotEmpty property="startRow">
            <isNotEmpty property="endRow">
                <![CDATA[ ) g ) tmp where tmp.NUMROW <= #endRow# and tmp.NUMROW >= #startRow# ]]>
            </isNotEmpty>
        </isNotEmpty>
    </select>

    <select id="getTeamLog" parameterClass="java.util.Map" resultMap="teamLogResult">
        select * from team_log where 1=1
        <isNotEmpty prepend="and" property="userId">
            user_id=#userId#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="teamLogId">
            team_log_id=#teamLogId#
        </isNotEmpty>
        fetch first 1 row only
    </select>

    <!-- 获取选中部门下所有要填写的人数 -->
    <select id="getNeedTeamLogCount" parameterClass="java.lang.Integer" resultClass="java.lang.Integer">
          select count(*) from sys_user su where su.user_id in(
            select sm.user_id from sys_role_member sm where sm.role_id in(
              select sr.role_id from sys_role sr where sr.role_id in (select sm.role_id from sys_menu_auth sm where sm.menu_id=303) and sr.is_del=0
            ) and sm.user_id in(
              select c.user_id from sys_user c where  c.dept_id in(
                select a.dept_id from sys_dept a where a.dept_search_code like (select d.dept_search_code||'%' from sys_dept d where dept_id=#deptId# and is_del=0) and is_del=0
              ) and c.is_del=0
            )
            ) and su.is_del=0
    </select>

    <!-- 获取选中部门下所有已经填写的人数 -->
    <select id="getNeedTeamLogCountWhitWriter" parameterClass="java.lang.Integer" resultClass="java.lang.Integer">
        select count(*) from team_log tl where tl.user_id in(
          select su.user_id from sys_user su where su.user_id in(
            select sm.user_id from sys_role_member sm where sm.role_id in(
              select sr.role_id from sys_role sr where sr.role_id in (select sm.role_id from sys_menu_auth sm where sm.menu_id=303) and sr.is_del=0
            ) and sm.user_id in(
              select c.user_id from sys_user c where  c.dept_id in(
                select a.dept_id from sys_dept a where a.dept_search_code like (select d.dept_search_code||'%' from sys_dept d where dept_id=#deptId# and is_del=0) and is_del=0
              ) and c.is_del=0
            )
            ) and su.is_del=0
        ) and tl.update_date>(current date)
    </select>


    <!-- 获取选中部门下所有已经填写个人日志的数据统计 -->
    <select id="getTeamLogSum" parameterClass="java.lang.Integer" resultMap="teamLogResult">
      select count(tl.user_id) as team_Log_Id,0 as user_Id,sum(zrzjdhyx) as zrzjdhyx,sum(zrzjsdyx) as zrzjsdyx,sum(zrzjjdzx) as zrzjjdzx,
        sum(zrzjjdsq) as  zrzjjdsq,sum(zrzjdcbs) as zrzjdcbs,sum(zrzjfdbs) as zrzjfdbs,sum(zrzjdhbs) as zrzjdhbs,sum(zrzjshbs) as zrzjshbs,
        sum(jrjhdhyx) as jrjhdhyx,sum(jrjhsdyx) as jrjhsdyx,sum(jrjhjdzc) as jrjhjdzc,sum(jrjhjdsq) as jrjhjdsq,sum(jrjhdcbs) as jrjhdcbs,
        sum(jrjhfdbs) as jrjhfdbs,sum(jrjhdhbs) as jrjhdhbs,sum(jrjhshbs) as jrjhshbs,sum(dclbs) as dclbs,sum(byxzbs) as byxzbs,sum(byzdbs) as byzdbs,
        sum(bydjbs) as bydjbs,sum(byljtgbs) as byljtgbs,sum(bydqbs) as bydqbs,sum(byjzhsrwzb) as byjzhsrwzb,sum(byjzyerwzb) as byjzyerwzb,
        sum(bytqjqbs) as bytqjqbs,sum(bytqjqje) as bytqjqje,sum(bytgwffje) as bytgwffje,sum(yjydfkje) as yjydfkje,sum(yjydjzje) as yjydjzje,
        sum(byfkbs) as byfkbs,cast(ROUND(avg(byfkjqll),4) as numeric(8,2)) as byfkjqll,sum(byyyehs) as byyyehs,sum(syyyehs) as syyyehs,sum(byjzhs) as byjzhs,sum(byfkje) as byfkje,
        sum(bydkye) as bydkye,sum(sydkye) as sydkye,sum(byjzye) as byjzye,null as create_Date,null as update_Date,null as create_User,null as update_User
        from team_log tl where tl.user_id in(
        select su.user_id from sys_user su where su.user_id in(
            select sm.user_id from sys_role_member sm where sm.role_id in(
                select sr.role_id from sys_role sr where sr.role_id in (select sm.role_id from sys_menu_auth sm where sm.menu_id=303) and sr.is_del=0
            ) and sm.user_id in(
            select c.user_id from sys_user c where  c.dept_id in(
            select a.dept_id from sys_dept a where a.dept_search_code like (select d.dept_search_code||'%' from sys_dept d where dept_id=#deptId# and is_del=0) and is_del=0
        ) and c.is_del=0
        )
        ) and su.is_del=0
    ) and tl.update_date>(current date)
    </select>

    <!-- 查询本机构的所有需要填写个人日志录入人数 -->
    <select id="getDeptTeamLogCount" parameterClass="java.lang.Integer" resultClass="java.lang.Integer">
          select count(*) from sys_user su where su.user_id in(
            select sm.user_id from sys_role_member sm where sm.role_id in(
              select sr.role_id from sys_role sr where sr.role_id in (select sm.role_id from sys_menu_auth sm where sm.menu_id=303) and sr.is_del=0
            ) and sm.user_id in(
              select c.user_id from sys_user c where  c.dept_id=#deptId# and c.is_del=0
            )
            ) and su.is_del=0
    </select>

    <!-- 查询本机构的已经填写个人日志录入人数 -->
    <select id="getDeptTeamLogCountWhitWriter" parameterClass="java.lang.Integer" resultClass="java.lang.Integer">
         select count(*) from team_log tl where tl.user_id in(
          select su.user_id from sys_user su where su.user_id in(
            select sm.user_id from sys_role_member sm where sm.role_id in(
              select sr.role_id from sys_role sr where sr.role_id in (select sm.role_id from sys_menu_auth sm where sm.menu_id=303) and sr.is_del=0
            ) and sm.user_id in(
              select c.user_id from sys_user c where  c.dept_id=#deptId# and c.is_del=0
            )
            ) and su.is_del=0
        ) and tl.update_date>(current date)
    </select>

    <!-- 获取选中部门的（不包含下属机构）所有已经填写个人日志的数据统计 -->
    <select id="getDeptTeamLogSum" parameterClass="java.lang.Integer" resultMap="teamLogResult">
      select count(tl.user_id) as team_Log_Id,0 as user_Id,sum(zrzjdhyx) as zrzjdhyx,sum(zrzjsdyx) as zrzjsdyx,sum(zrzjjdzx) as zrzjjdzx,
        sum(zrzjjdsq) as  zrzjjdsq,sum(zrzjdcbs) as zrzjdcbs,sum(zrzjfdbs) as zrzjfdbs,sum(zrzjdhbs) as zrzjdhbs,sum(zrzjshbs) as zrzjshbs,
        sum(jrjhdhyx) as jrjhdhyx,sum(jrjhsdyx) as jrjhsdyx,sum(jrjhjdzc) as jrjhjdzc,sum(jrjhjdsq) as jrjhjdsq,sum(jrjhdcbs) as jrjhdcbs,
        sum(jrjhfdbs) as jrjhfdbs,sum(jrjhdhbs) as jrjhdhbs,sum(jrjhshbs) as jrjhshbs,sum(dclbs) as dclbs,sum(byxzbs) as byxzbs,sum(byzdbs) as byzdbs,
        sum(bydjbs) as bydjbs,sum(byljtgbs) as byljtgbs,sum(bydqbs) as bydqbs,sum(byjzhsrwzb) as byjzhsrwzb,sum(byjzyerwzb) as byjzyerwzb,
        sum(bytqjqbs) as bytqjqbs,sum(bytqjqje) as bytqjqje,sum(bytgwffje) as bytgwffje,sum(yjydfkje) as yjydfkje,sum(yjydjzje) as yjydjzje,
        sum(byfkbs) as byfkbs,cast(ROUND(avg(byfkjqll),4) as numeric(8,2)) as byfkjqll,sum(byyyehs) as byyyehs,sum(syyyehs) as syyyehs,sum(byjzhs) as byjzhs,sum(byfkje) as byfkje,
        sum(bydkye) as bydkye,sum(sydkye) as sydkye,sum(byjzye) as byjzye,null as create_Date,null as update_Date,null as create_User,null as update_User
        from team_log tl where tl.user_id in(
        select su.user_id from sys_user su where su.user_id in(
            select sm.user_id from sys_role_member sm where sm.role_id in(
                select sr.role_id from sys_role sr where sr.role_id in (select sm.role_id from sys_menu_auth sm where sm.menu_id=303) and sr.is_del=0
            ) and sm.user_id in(
            select c.user_id from sys_user c where  c.dept_id =#deptId# and c.is_del=0
        )
        ) and su.is_del=0
    ) and tl.update_date>(current date)
    </select>
</sqlMap>